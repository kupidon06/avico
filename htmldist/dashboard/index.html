{% extends "layouts/base.html" %} {% load static %} {% block content %} <div class="min-h-screen bg-gray-100 dark:bg-gray-900 p-6"><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://cdn.datatables.net/1.13.6/js/dataTables.tailwindcss.min.js"></script><h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6">üìäDashboard de Gestion des Lots</h1><form id="filter-form" class="mb-6"><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6"><div><label for="from" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Date de d√©but</label> <input type="date" id="from" class="mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 dark:text-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></div><div><label for="to" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Date de fin</label> <input type="date" id="to" class="mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 dark:text-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></div><div><label for="building_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">B√¢timent</label> <input type="text" id="building_id" class="mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 dark:text-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></div><div><label for="batch_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Lot</label> <select id="batch_id" class="mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 dark:text-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"> {% for batch in batches %} <option value="{{ batch.id }}">{{ batch.name }}</option> {% endfor %} </select></div><div><button type="submit" class="mt-6 w-full inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Filtrer</button></div></div></form><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"><div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow"><h2 class="text-gray-600 dark:text-gray-300 text-sm">Total Poulets Actuels</h2><p class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="total-chickens">0</p><div class="loader" id="total-chickens-loader"></div></div><div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow"><h2 class="text-gray-600 dark:text-gray-300 text-sm">Total ≈íufs Collect√©s</h2><p class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="total-eggs">0</p><div class="loader" id="total-eggs-loader"></div></div><div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow"><h2 class="text-gray-600 dark:text-gray-300 text-sm">Revenu Total (FCFA)</h2><p class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="total-revenue">0</p><div class="loader" id="total-revenue-loader"></div></div><div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow"><h2 class="text-gray-600 dark:text-gray-300 text-sm">Taux de Mortalit√©</h2><p class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="mortality-rate">0%</p><div class="loader" id="mortality-rate-loader"></div></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow" style="height:300px"><h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Mortalit√© et Collecte d'≈íufs</h3><canvas id="mortalityEggsChart" style="max-height:250px"></canvas><div class="loader" id="mortalityEggsChart-loader"></div></div><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow" style="height:300px"><h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Rentabilit√© Mensuelle</h3><canvas id="profitabilityChart" style="max-height:250px"></canvas><div class="loader" id="profitabilityChart-loader"></div></div></div><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow"><h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">D√©tails des Lots</h3><div class="overflow-x-auto"><div class="inline-block min-w-full align-middle"><div class="overflow-hidden shadow rounded-lg"><table class="min-w-full divide-y divide-gray-200 table-fixed dark:divide-gray-600" id="batch-details"><thead class="text-xs text-gray-700 dark:text-gray-400 uppercase bg-gray-50 dark:bg-gray-700"><tr><th scope="col" class="px-6 py-3">Nom du Lot</th><th scope="col" class="px-6 py-3">Race</th><th scope="col" class="px-6 py-3">B√¢timent</th><th scope="col" class="px-6 py-3">Quantit√© Actuelle</th><th scope="col" class="px-6 py-3">≈íufs Collect√©s</th><th scope="col" class="px-6 py-3">Revenu Total</th><th scope="col" class="px-6 py-3">Taux de Mortalit√©</th><th scope="col" class="px-6 py-3">Taux de Ponte</th></tr></thead><tbody></tbody></table></div></div></div><div class="loader" id="batch-details-loader"></div></div></div><script>async function fetchData(t={}){let e="/management/batch-statistics/";const a=new URLSearchParams(t).toString();a&&(e+=`?${a}`);const n=await fetch(e);return await n.json()}function renderChart(t,e,a,n){const o=document.getElementById(t).getContext("2d");new Chart(o,{type:"bar",data:{labels:e,datasets:[{label:n,data:a,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}function updateStatistics(t){document.getElementById("total-chickens").textContent=t.reduce(((t,e)=>t+e.current_poultry),0),document.getElementById("total-eggs").textContent=t.reduce(((t,e)=>t+e.total_eggs_collected),0),document.getElementById("total-revenue").textContent=t.reduce(((t,e)=>t+e.total_revenue),0),document.getElementById("mortality-rate").textContent=(t.reduce(((t,e)=>t+e.mortality_rate),0)/t.length).toFixed(2)+"%"}function updateBatchDetails(t){const e=document.getElementById("batch-details").querySelector("tbody");e.innerHTML="",t.forEach((t=>{const a=document.createElement("tr");a.classList.add("bg-white","dark:bg-gray-700","border-b"),a.innerHTML=`\n        <td class="px-6 py-4">${t.name}</td>\n        <td class="px-6 py-4">${t.breed}</td>\n        <td class="px-6 py-4">${t.building}</td>\n        <td class="px-6 py-4">${t.current_poultry}</td>\n        <td class="px-6 py-4">${t.total_eggs_collected}</td>\n        <td class="px-6 py-4">${t.total_revenue} FCFA</td>\n        <td class="px-6 py-4">${t.mortality_rate}%</td>\n        <td class="px-6 py-4">${t.laying_rate}%</td>\n      `,e.appendChild(a)}))}async function loadInitialData(){showLoaders();const t=await fetchData();hideLoaders();const e=t.map((t=>t.name)),a=t.map((t=>t.mortality_rate)),n=(t.map((t=>t.laying_rate)),t.map((t=>t.total_revenue)));renderChart("mortalityEggsChart",e,a,"Taux de Mortalit√©"),renderChart("profitabilityChart",e,n,"Revenu Total"),updateStatistics(t),updateBatchDetails(t)}function showLoaders(){document.querySelectorAll(".loader").forEach((t=>t.style.display="block"))}function hideLoaders(){document.querySelectorAll(".loader").forEach((t=>t.style.display="none"))}window.onload=loadInitialData,document.getElementById("filter-form").addEventListener("submit",(async t=>{t.preventDefault();const e={from:document.getElementById("from").value,to:document.getElementById("to").value,building_id:document.getElementById("building_id").value,batch_id:document.getElementById("batch_id").value};showLoaders();const a=await fetchData(e);hideLoaders();const n=a.map((t=>t.name)),o=a.map((t=>t.mortality_rate)),d=(a.map((t=>t.laying_rate)),a.map((t=>t.total_revenue)));renderChart("mortalityEggsChart",n,o,"Taux de Mortalit√©"),renderChart("profitabilityChart",n,d,"Revenu Total"),updateStatistics(a),updateBatchDetails(a)}))</script><style>.loader{display:none;border:4px solid #f3f3f3;border-radius:50%;border-top:4px solid #3498db;width:24px;height:24px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style> {% endblock content %}